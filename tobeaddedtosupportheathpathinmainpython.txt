if __name__ == "__main__":
    import argparse
    from fastapi import FastAPI
    from fastapi.responses import JSONResponse
    import uvicorn
    import asyncio
    
    parser = argparse.ArgumentParser(description="CAMARA FastMCP Server")
    parser.add_argument("--server", action="store_true", 
                       help="Enable HTTP server mode")
    parser.add_argument("--host", default="0.0.0.0", 
                       help="Server host")
    parser.add_argument("--port", type=int, default=8000, 
                       help="Server port")
    args = parser.parse_args()
    
    print("="*60)
    print("FINAL CAMARA COMPLETE SERVER")
    print("="*60)
    print(f"Version     : {CAMARA_VERSION.upper()}")
    print(f"Base URL    : {CAMARA_BASE_URL}")
    print(f"Endpoints   : {len(API_ENDPOINTS)} from 10 GitHub repos")
    print(f"API Key     : {'✓ Configured' if CAMARA_API_KEY else '✗ Missing'}")
    print("="*60)
    
    if args.server:
        # Create FastAPI app with health endpoint
        app = FastAPI()
        
        @app.get("/health")
        async def health_check():
            return JSONResponse({
                "status": "healthy",
                "service": "CAMARA MCP Server",
                "version": CAMARA_VERSION,
                "endpoints": len(API_ENDPOINTS)
            })
        
        # Mount MCP at /mcp
        from fastmcp import FastMCP
        app.mount("/mcp", mcp.get_asgi_app())
        
        print(f"Mode        : HTTP Server")
        print(f"Listen      : {args.host}:{args.port}")
        print(f"Health      : http://{args.host}:{args.port}/health")
        print(f"MCP         : http://{args.host}:{args.port}/mcp")
        print("="*60)
        
        uvicorn.run(app, host=args.host, port=args.port)
    else:
        # Claude Desktop mode
        print(f"Mode        : Claude Desktop (SSE)")
        print("="*60)
        mcp.run()
